<!DOCTYPE html>
<!-- saved from url=(0066)http://wap.js.10086.cn/hyl/CAC/wpactivity/hxhzyItem/hxhzyItem.html -->
<html>
<head lang=en>
    <title>条形码扫描示例</title>
    <meta content="text/html; charset=UTF-8" http-equiv=Content-Type>
    <meta name=viewport
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;">
    <meta name=apple-mobile-web-app-capable content=yes>
    <meta name=apple-mobile-web-app-status-bar-style content=black>
    <meta name=GENERATOR content="MShtml 8.00.6001.23588">
    <script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="js/util.js"></script>
    <script type="text/javascript" src="js/quagga.min.js"></script>
    <script type="text/javascript" src="js/LocalResizeIMG.js"></script>
    <script type="text/javascript" src="js/patch/mobileBUGFix.mini.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {

            //文件上传
            $.each($('#sform input:file'), function (index, item) {
                //文件压缩
                $(item).localResizeIMG({
                    //width : 800,
                    quality: 1,
                    before: function () {
                        util.showMask();
                    },
                    success: function (result) {
                        var imgData = result.clearBase64;
                        Quagga.decodeSingle({
                            //解码方式，与条形码的编码方式有关
                            decoder: {
                                readers: ["code_128_reader", "ean_reader", "ean_8_reader", "code_39_reader", "code_39_vin_reader", "codabar_reader", "upc_reader", "upc_e_reader", "i2of5_reader"] // List of active readers
                            },
                            locate: true, // try to locate the barcode in the image
                            src: 'data:image/jpg;base64,' + imgData // or 'data:image/jpg;base64,' + data
                        }, function (result) {
                            if (result) {
                                if (result.codeResult) {
                                    $("#result").val(result.codeResult.code);
                                    $("#info").show();
                                    var code = result.codeResult.code;

                                } else {
                                    $("#result").val("");
                                    alert("未扫码成功，请重新扫码!");
                                }
                            } else {
                                alert("挂了!");
                                $("#result").val("");
                            }
                            util.removeMask();
                        });
                    }
                });
            });
            $("#getData").click(function () {
                var code = $("#result").val()
                $.ajax({
                    type: "get",//指定请求方式
                    url: "getData?code=" + code, //请求路径
                    dataType: "json",//指定返回字符串以json格式返回,若不指定则以字符串方式返回(js识别不了的json)
                    success: function (result) {//进入success里,jquery已经把服务端传来的字符串解析到result里的 所以这里不需要加上result.responseText
                        $("#info").show();
                        $("#id").text(result.custkey)
                        $("#id2").text(result.cust_description)
                        $("#id3").text(result.barcode1)
                        $("#id4").text(result.sku_description)
                        $("#id5").text(result.lottable01)
                        $("#id6").text(result.lottable02)
                        $("#id7").text(result.lottable03)
                        $("#id8").text(result.lottable04)
                        $("#id9").text(result.confirmdate)
                    },
                    error: function (result) {//response.status=500进入error方法里 参数:result代表是整个response对象
                        alert(result.responseText);//拿到response的传输的文本
                    }
                });
            });

        });

    </script>
</head>
<body>
<div>
    <form id="sform" method="post" name="sform" enctype="multipart/form-data">
        <p>
            <input type="button" class="upload-btn" value="扫码" onclick="$('#code').click();"/>
            <span><input class="infoInput"
                         id="result" style="width: 120px;" type="text" placeholder=""/></span>
            <input id="code" class="pad10 b-f" style="display: none;" type="file" accept="image/*"/>
            <input type="button" id="getData" class="upload-btn" value="搜索"/>
        </p>
    </form>
</div>
<h6>详细信息</h6>
<div id="info" style="display: none">
    <table border="1">
        <tr>
            <td>客户编码</td>
            <td id="id">$100</td>
        </tr>
        <tr>
            <td>客户名称</td>
            <td id="id2">$100</td>
        </tr>
        <tr>
            <td>客户条形码</td>
            <td id="id3">$100</td>
        </tr>
        <tr>
            <td>生产名称</td>
            <td id="id4">$100</td>
        </tr>
        <tr>
            <td>生产日期</td>
            <td id="id5">$100</td>
        </tr>
        <tr>
            <td>年根</td>
            <td id="id6">$100</td>
        </tr>
        <tr>
            <td>invoice No</td>
            <td id="id7">$100</td>
        </tr>
        <tr>
            <td>生产批号</td>
            <td id="id8">$100</td>
        </tr>
        <tr>
            <td>出库日期</td>
            <td id="id9">$100</td>
        </tr>
    </table>
</div>
</body>
</html>
<script>
</script>